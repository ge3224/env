#!/usr/bin/env bash

set -euo pipefail


echo "Configuring pacman..."

echo "Enabling pacman color and verbose output..."
sudo sed -i 's/^#Color$/Color/' /etc/pacman.conf
sudo sed -i 's/^#VerbosePkgLists$/VerbosePkgLists/' /etc/pacman.conf

echo "Enabling multilib repository..."
sudo sed -i '/^#\[multilib\]$/,/^#Include = \/etc\/pacman.d\/mirrorlist$/ {
    s/^#\[multilib\]$/[multilib]/
    s/^#Include = \/etc\/pacman.d\/mirrorlist$/Include = \/etc\/pacman.d\/mirrorlist/
}' /etc/pacman.conf

echo "Checking for internet connectivity..."
if ping -c 1 -W 2 archlinux.org >/dev/null 2>&1; then
    echo "Running system update..."
    sudo pacman -Syu --noconfirm
else
    echo "No internet connectivity detected, skipping system update"
    echo "Run 'sudo pacman -Syu' manually when online"
fi

echo "Pacman configuration complete!"
