#!/usr/bin/env bash

set -euo pipefail

log() {
    echo "[I3] $1"
}

DOTFILES_DIR="${DEV_ENV:-$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)}"

log "Setting up i3 window manager..."

# Create symlink for monitor switch script
log "Creating symlink to screens.sh script..."
sudo ln -sf "$DOTFILES_DIR/scripts/screens.sh" "/usr/local/bin/screens.sh"
sudo chmod 0755 "/usr/local/bin/screens.sh"

# Install i3, i3status, and dmenu
log "Installing i3, i3status, and dmenu..."
sudo pacman -S --needed --noconfirm i3 i3status dmenu

# Remove existing i3 config (directory or symlink)
if [ -e "$HOME/.config/i3" ] || [ -L "$HOME/.config/i3" ]; then
    log "Removing existing i3 config..."
    rm -rf "$HOME/.config/i3"
fi

# Create symlink to i3 config
log "Creating symlink to i3 config..."
ln -sf "$DOTFILES_DIR/dotfiles/i3/configs/i3" "$HOME/.config/i3"

# Remove existing i3status config (directory or symlink)
if [ -e "$HOME/.config/i3status" ] || [ -L "$HOME/.config/i3status" ]; then
    log "Removing existing i3status config..."
    rm -rf "$HOME/.config/i3status"
fi

# Create symlink to i3status config
log "Creating symlink to i3status config..."
ln -sf "$DOTFILES_DIR/dotfiles/i3/configs/i3status" "$HOME/.config/i3status"

log "i3 window manager configuration complete!"
