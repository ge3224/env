#!/usr/bin/env bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DOTFILES_DIR="$(dirname "$SCRIPT_DIR")"
source "$SCRIPT_DIR/_common.sh"

echo "Setting up tmux configuration..."

echo "Installing tmux..."
install_packages tmux
echo "tmux installed successfully!"
if [ -f "$HOME/.tmux.conf" ] && [ ! -L "$HOME/.tmux.conf" ]; then
    echo "Backing up existing .tmux.conf to .tmux.conf.backup"
    cp "$HOME/.tmux.conf" "$HOME/.tmux.conf.backup"
fi

echo "Creating symlink to tmux.conf"
ln -sf "$DOTFILES_DIR/files/tmux/tmux.conf" "$HOME/.tmux.conf"

echo "Installing tmux-sessionizer..."
mkdir -p "$HOME/.local/bin"
ln -sf "$DOTFILES_DIR/files/bin/tmux-sessionizer" "$HOME/.local/bin/tmux-sessionizer"

echo "Installing tmux-sessionizer config..."
mkdir -p "$HOME/.config/tmux-sessionizer"
ln -sf "$DOTFILES_DIR/files/tmux-sessionizer/tmux-sessionizer.conf" "$HOME/.config/tmux-sessionizer/tmux-sessionizer.conf"

echo "Tmux configuration installed successfully!"
echo "Start a new tmux session with 'tmux' to use the new configuration."
echo "Press <prefix> + f to use tmux-sessionizer for fuzzy project switching."