#!/usr/bin/env bash

set -euo pipefail

log() {
    echo "[PRINTING] $1"
}

log "Setting up CUPS printing system..."

# Install CUPS and tools
log "Installing CUPS..."
sudo pacman -S --needed --noconfirm \
    cups \
    cups-pdf \
    system-config-printer \
    ghostscript \
    gsfonts

# Install printer drivers
log "Installing printer drivers..."
sudo pacman -S --needed --noconfirm \
    gutenprint \
    hplip \
    splix

# Start and enable CUPS service
log "Enabling CUPS service..."
sudo systemctl enable --now cups.service

# Add user to lp group
log "Adding $USER to lp group..."
sudo usermod -aG lp "$USER"

log "CUPS printing system installed!"
log "Note: You may need to log out and back in for group changes to take effect"
log "Configure printers at http://localhost:631 or use system-config-printer"
