#!/usr/bin/env bash

set -euo pipefail

log() {
    echo "[ZSH] $1"
}

DOTFILES_DIR="${DEV_ENV:-$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)}"

log "Setting up zsh..."

# Install zsh
log "Installing zsh..."
sudo pacman -S --needed --noconfirm zsh

# Set zsh as default shell
log "Setting zsh as default shell for $USER..."
sudo chsh -s /usr/bin/zsh "$USER"

# Remove existing .zshrc (whether file or symlink)
if [ -e "$HOME/.zshrc" ] || [ -L "$HOME/.zshrc" ]; then
    log "Removing existing .zshrc..."
    rm -f "$HOME/.zshrc"
fi

# Create symlink for .zshrc
log "Creating symlink to .zshrc..."
ln -sf "$DOTFILES_DIR/dotfiles/zsh/.zshrc" "$HOME/.zshrc"

log "Zsh configuration complete!"
log "Note: You may need to log out and back in for the shell change to take effect"
