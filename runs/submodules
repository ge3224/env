#!/usr/bin/env bash

set -euo pipefail


echo "Initializing git submodules..."

repo_dir="${DEV_ENV:-$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)}"
if [ ! -d "$repo_dir/.git" ]; then
    echo "ERROR: Not a git repository: $repo_dir"
    exit 1
fi

cd "$repo_dir"

echo "Running git submodule init..."
if git submodule init 2>&1; then
    echo "Submodules initialized"
else
    echo "WARNING: Submodule init had issues (may already be initialized)"
fi

echo "Running git submodule update..."
if git submodule update; then
    echo "Submodules updated"
else
    echo "ERROR: Failed to update submodules"
    exit 1
fi

echo "Git submodules ready!"
