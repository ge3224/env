#!/usr/bin/env bash

set -euo pipefail

log() {
    echo "[SUBMODULES] $1"
}

log "Initializing git submodules..."

# Get the repository root directory
repo_dir="${DEV_ENV:-$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)}"

# Check if we're in a git repository
if [ ! -d "$repo_dir/.git" ]; then
    log "ERROR: Not a git repository: $repo_dir"
    exit 1
fi

cd "$repo_dir"

# Initialize submodules
log "Running git submodule init..."
if git submodule init 2>&1; then
    log "Submodules initialized"
else
    log "WARNING: Submodule init had issues (may already be initialized)"
fi

# Update submodules
log "Running git submodule update..."
if git submodule update; then
    log "Submodules updated"
else
    log "ERROR: Failed to update submodules"
    exit 1
fi

log "Git submodules ready!"
